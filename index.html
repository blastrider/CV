<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Maxime Guillemin — CV</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600&family=Space+Grotesk:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <svg class="geo-bg" viewBox="0 0 800 600" aria-hidden="true">
      <defs>
        <g id="invader">
          <rect x="2" y="0" width="2" height="2" />
          <rect x="6" y="0" width="2" height="2" />
          <rect x="10" y="0" width="2" height="2" />
          <rect x="14" y="0" width="2" height="2" />
          <rect x="0" y="2" width="2" height="2" />
          <rect x="4" y="2" width="2" height="2" />
          <rect x="12" y="2" width="2" height="2" />
          <rect x="16" y="2" width="2" height="2" />
          <rect x="0" y="4" width="2" height="2" />
          <rect x="2" y="4" width="2" height="2" />
          <rect x="4" y="4" width="2" height="2" />
          <rect x="6" y="4" width="2" height="2" />
          <rect x="8" y="4" width="2" height="2" />
          <rect x="10" y="4" width="2" height="2" />
          <rect x="12" y="4" width="2" height="2" />
          <rect x="14" y="4" width="2" height="2" />
          <rect x="16" y="4" width="2" height="2" />
          <rect x="2" y="6" width="2" height="2" />
          <rect x="6" y="6" width="2" height="2" />
          <rect x="10" y="6" width="2" height="2" />
          <rect x="14" y="6" width="2" height="2" />
          <rect x="4" y="8" width="2" height="2" />
          <rect x="12" y="8" width="2" height="2" />
          <rect x="2" y="10" width="2" height="2" />
          <rect x="14" y="10" width="2" height="2" />
        </g>
      </defs>
      <g class="invader-field">
        <g class="invader-row">
          <use href="#invader" x="90" y="90" class="invader" />
          <use href="#invader" x="170" y="90" class="invader" />
          <use href="#invader" x="250" y="90" class="invader" />
          <use href="#invader" x="330" y="90" class="invader" />
          <use href="#invader" x="410" y="90" class="invader" />
          <use href="#invader" x="490" y="90" class="invader" />
          <use href="#invader" x="570" y="90" class="invader" />
        </g>
        <g class="invader-row">
          <use href="#invader" x="120" y="170" class="invader" />
          <use href="#invader" x="200" y="170" class="invader" />
          <use href="#invader" x="280" y="170" class="invader" />
          <use href="#invader" x="360" y="170" class="invader" />
          <use href="#invader" x="440" y="170" class="invader" />
          <use href="#invader" x="520" y="170" class="invader" />
        </g>
        <g class="invader-row">
          <use href="#invader" x="80" y="250" class="invader" />
          <use href="#invader" x="160" y="250" class="invader" />
          <use href="#invader" x="240" y="250" class="invader" />
          <use href="#invader" x="320" y="250" class="invader" />
          <use href="#invader" x="400" y="250" class="invader" />
          <use href="#invader" x="480" y="250" class="invader" />
          <use href="#invader" x="560" y="250" class="invader" />
        </g>
        <g class="invader-row">
          <use href="#invader" x="140" y="330" class="invader" />
          <use href="#invader" x="220" y="330" class="invader" />
          <use href="#invader" x="300" y="330" class="invader" />
          <use href="#invader" x="380" y="330" class="invader" />
          <use href="#invader" x="460" y="330" class="invader" />
          <use href="#invader" x="540" y="330" class="invader" />
        </g>
      </g>
    </svg>
    <svg class="sprite" aria-hidden="true">
      <symbol id="icon-user" viewBox="0 0 24 24">
        <path
          d="M12 13.2c2.6 0 4.7-2.2 4.7-4.9S14.6 3.4 12 3.4 7.3 5.6 7.3 8.3s2.1 4.9 4.7 4.9z"
        />
        <path
          d="M4.4 20.6c0-3.4 3.5-5.7 7.6-5.7s7.6 2.3 7.6 5.7"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
      </symbol>
      <symbol id="icon-location" viewBox="0 0 24 24">
        <path
          d="M12 21s6.4-6 6.4-11a6.4 6.4 0 1 0-12.8 0c0 5 6.4 11 6.4 11z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
        />
        <circle cx="12" cy="10" r="2.6" />
      </symbol>
      <symbol id="icon-phone" viewBox="0 0 24 24">
        <path
          d="M6.1 4.2l3 1.2-.8 3.2 2.9 2.9 3.2-.8 1.2 3c-2.4 2.6-6.2 2.8-8.9.2-2.7-2.7-2.4-6.5.2-9z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </symbol>
      <symbol id="icon-mail" viewBox="0 0 24 24">
        <path
          d="M4.5 7h15a1.5 1.5 0 0 1 1.5 1.5v7A1.5 1.5 0 0 1 19.5 17h-15A1.5 1.5 0 0 1 3 15.5v-7A1.5 1.5 0 0 1 4.5 7z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
        />
        <path
          d="M4.5 8.5l7.5 5 7.5-5"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </symbol>
      <symbol id="icon-car" viewBox="0 0 24 24">
        <path
          d="M4.5 12.5l1.6-4.2h11.8l1.6 4.2"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
        <rect x="3.5" y="12.5" width="17" height="5" rx="1.2" />
        <circle cx="7" cy="18.5" r="1.3" />
        <circle cx="17" cy="18.5" r="1.3" />
      </symbol>
      <symbol id="icon-linux" viewBox="0 0 24 24">
        <path
          d="M8.2 9.3c0-2 1.7-3.7 3.8-3.7s3.8 1.7 3.8 3.7-1.7 3.7-3.8 3.7-3.8-1.7-3.8-3.7z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
        />
        <path
          d="M6.4 18.2c1.5-2.4 3.4-3.6 5.6-3.6s4.1 1.2 5.6 3.6"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
      </symbol>
      <symbol id="icon-windows" viewBox="0 0 24 24">
        <path d="M3.5 5.3l7.4-1v7.4H3.5z" />
        <path d="M13.1 4l7.4-1.1v8.8h-7.4z" />
        <path d="M3.5 12.1h7.4v7.2l-7.4-1z" />
        <path d="M13.1 12.1h7.4v8.9l-7.4-1.2z" />
      </symbol>
      <symbol id="icon-cloud" viewBox="0 0 24 24">
        <path
          d="M6.2 16.6a3.8 3.8 0 0 1 .3-7.6A5.3 5.3 0 0 1 17 9.9a3.5 3.5 0 1 1 .4 6.9z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </symbol>
      <symbol id="icon-automation" viewBox="0 0 24 24">
        <path
          d="M7 6.2h10M7 11.2h10M7 16.2h6"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
        <circle cx="17.5" cy="16.2" r="2.1" />
      </symbol>
      <symbol id="icon-devops" viewBox="0 0 24 24">
        <path
          d="M8 6.5l-3.5 3.6L8 13.7"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M16 6.5l3.5 3.6-3.5 3.6"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M10.5 16.5l3-9"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
      </symbol>
      <symbol id="icon-server" viewBox="0 0 24 24">
        <rect x="4.2" y="4.6" width="15.6" height="5.6" rx="1.4" />
        <rect x="4.2" y="12" width="15.6" height="7.4" rx="1.4" />
        <circle cx="8" cy="7.4" r="0.9" />
        <circle cx="8" cy="15.6" r="0.9" />
      </symbol>
      <symbol id="icon-code" viewBox="0 0 24 24">
        <path
          d="M8.5 7.2L4.5 12l4 4.8M15.5 7.2l4 4.8-4 4.8"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </symbol>
    </svg>
    <main class="page">
      <header class="hero">
        <div class="hero__identity">
          <p class="hero__eyebrow">Administrateur systèmes & réseaux • DevOps</p>
          <h1>Maxime Guillemin</h1>
          <p class="hero__summary">
            Professionnel entreprenant et tenace, particulièrement à l’aise en
            debug et en résolution de problèmes complexes.
          </p>
        </div>
        <aside class="hero__contact">
          <h2>Contact</h2>
          <div class="toggle-group">
            <span class="toggle-label">Thème</span>
            <div class="toggle" role="group" aria-label="Thème">
              <button type="button" data-theme-toggle="light">Light</button>
              <button type="button" data-theme-toggle="dark">Dark</button>
            </div>
          </div>
          <div class="toggle-group">
            <span class="toggle-label">Densité</span>
            <div class="toggle" role="group" aria-label="Densité">
              <button type="button" data-density-toggle="normal">Normal</button>
              <button type="button" data-density-toggle="compact">Compact</button>
            </div>
          </div>
          <ul class="contact-list">
            <li>
              <svg class="icon" aria-hidden="true"><use href="#icon-user" /></svg>
              2 rue des Cygnes, 85340 Les Sables d'Olonne
            </li>
            <li>
              <svg class="icon" aria-hidden="true"><use href="#icon-location" /></svg>
              Olonne-sur-Mer
            </li>
            <li>
              <svg class="icon" aria-hidden="true"><use href="#icon-phone" /></svg>
              06 87 28 20 60
            </li>
            <li>
              <svg class="icon" aria-hidden="true"><use href="#icon-mail" /></svg>
              guimaxali@gmail.com
            </li>
            <li>
              <svg class="icon" aria-hidden="true"><use href="#icon-car" /></svg>
              Permis B
            </li>
          </ul>
        </aside>
      </header>

      <section class="grid">
        <div class="card">
          <h2>Profil</h2>
          <p>
            36 ans, basé à Olonne-sur-Mer. Spécialisé en administration systèmes
            Linux/Windows, migrations, DevOps et automatisation d’infrastructures.
          </p>
          <p>
            À l’aise avec les environnements on-premise et hébergés, avec une
            expérience des marchés publics.
          </p>
        </div>

        <div class="card skills-card" data-skills-collapsed="false">
          <div class="skills-header">
            <h2>Compétences clés</h2>
            <button
              type="button"
              class="skills-toggle"
              data-skills-toggle
              aria-expanded="true"
              aria-label="Masquer les technos"
            >
              -
            </button>
          </div>
          <div class="skill-group">
            <h3>Systèmes</h3>
            <ul class="tag-list">
              <li>Ubuntu (Server/Desktop)</li>
              <li>Debian (Server/Desktop)</li>
              <li>Rocky Linux (Server/Desktop)</li>
              <li>Manjaro (Desktop)</li>
              <li>Linux Mint (Desktop)</li>
              <li>FreeBSD (Server/Desktop)</li>
              <li>Windows Server / Active Directory</li>
            </ul>
          </div>
          <div class="skill-group">
            <h3>Virtualisation & stockage</h3>
            <ul class="tag-list">
              <li>Proxmox</li>
              <li>QEMU/KVM</li>
              <li>ZFS</li>
              <li>Ceph</li>
            </ul>
          </div>
          <div class="skill-group">
            <h3>DevOps & plateformes</h3>
            <ul class="tag-list">
              <li>DevOps & CI/CD</li>
              <li>Azure DevOps</li>
              <li>MKS</li>
              <li>Docker</li>
              <li>Kubernetes</li>
            </ul>
          </div>
          <div class="skill-group">
            <h3>Automatisation & packaging</h3>
            <ul class="tag-list">
              <li>OpenTofu</li>
              <li>Ansible</li>
              <li>Packer</li>
              <li>Systemd</li>
              <li>Packaging DEB/RPM</li>
            </ul>
          </div>
          <div class="skill-group">
            <h3>Observabilité & dev</h3>
            <ul class="tag-list">
              <li>Zabbix</li>
              <li>Rust</li>
            </ul>
          </div>
        </div>

        <div class="card">
          <h2>Stack visuelle</h2>
          <div class="logo-grid">
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-linux" /></svg>
              <span>Linux</span>
            </div>
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-windows" /></svg>
              <span>Windows</span>
            </div>
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-cloud" /></svg>
              <span>Cloud & Hébergement</span>
            </div>
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-devops" /></svg>
              <span>DevOps / CI-CD</span>
            </div>
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-automation" /></svg>
              <span>IaC & Automatisation</span>
            </div>
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-server" /></svg>
              <span>Virtualisation</span>
            </div>
            <div class="logo-card">
              <svg class="logo" aria-hidden="true"><use href="#icon-code" /></svg>
              <span>Rust & Scripting</span>
            </div>
          </div>
        </div>
      </section>

      <section class="card experience">
        <h2>Expérience</h2>

        <article class="role">
          <div class="role__header">
            <div>
              <h3>Administrateur systèmes & réseaux</h3>
              <p class="role__meta">INNLOG — Olonne-sur-Mer</p>
            </div>
            <span class="role__dates">Depuis 2022</span>
          </div>
          <ul>
            <li>Administration Linux & Windows, support et exploitation au quotidien.</li>
            <li>Migrations Active Directory (DC propre vers hébergeur).</li>
            <li>DevOps chez OVH (MKS) et Azure DevOps, mise en place de pratiques CI/CD.</li>
            <li>Packaging DEB/RPM, création de services systemd.</li>
            <li>Infrastructure as Code avec OpenTofu, Ansible et Packer.</li>
            <li>Virtualisation et stockage: Proxmox, ZFS, Ceph.</li>
            <li>Développement Rust (vibe coding) avec un dépôt dédié.</li>
            <li>Deux programmes internes, dont un outil d’alerting Zabbix sous Linux Mint.</li>
          </ul>
        </article>

        <article class="role">
          <div class="role__header">
            <div>
              <h3>Administrateur systèmes</h3>
              <p class="role__meta">ANSSI / CFSSI</p>
            </div>
            <span class="role__dates">2020 – 2022</span>
          </div>
          <ul>
            <li>Migration d’Active Directory 2008 vers 2019.</li>
            <li>Installation et MCO/MCS de BigBlueButton (monitoring, sauvegardes).</li>
            <li>Déploiement de machines QEMU/KVM sous Debian.</li>
            <li>Administration et durcissement Debian.</li>
            <li>FreeBSD + ZFS pour stockage de sauvegardes avec rsync.</li>
            <li>Gestion de matériels audiovisuels (rétroprojecteurs, prise de son).</li>
          </ul>
        </article>
      </section>

      <section class="grid">
        <div class="card">
          <h2>Projets & réalisations</h2>
          <ul>
            <li>Outil Rust d’alerte Zabbix pour Linux Mint.</li>
            <li>Automatisations IaC avec OpenTofu, Ansible et Packer.</li>
            <li>Création de services systemd pour applications internes.</li>
            <li>Outil personnel “describe_me” (lien GitHub à ajouter).</li>
          </ul>
        </div>

        <div class="card">
          <h2>Temps libre</h2>
          <ul>
            <li>
              Expérimentations: HardenedBSD, routeurs FreeBSD/Linux, sites web
              statiques, outils CLI en Rust.
            </li>
            <li>Dépôt GitHub personnel (lien à ajouter).</li>
          </ul>
        </div>

        <div class="card game-card">
          <h2>Mini-jeu Space Invaders</h2>
          <p class="game-hint">
            Mobile: tap pour tirer, glisser gauche/droite pour déplacer. Clavier:
            flèches gauche/droite + Espace.
          </p>
          <div class="game-wrap">
            <canvas
              id="invaderGame"
              class="game-canvas"
              width="480"
              height="320"
              aria-label="Jeu Space Invaders"
            ></canvas>
            <div class="game-ui">
              <button type="button" data-game-action="toggle">Démarrer</button>
              <button type="button" data-game-action="reset">Réinitialiser</button>
              <span class="game-stat">Score: <span data-game-score>0</span></span>
              <span class="game-stat">Vies: <span data-game-lives>3</span></span>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Informations complémentaires</h2>
          <ul>
            <li>Permis B</li>
            <li>Anglais professionnel</li>
            <li>Expérience des marchés publics</li>
            <li>Disponibilité pour missions systèmes, DevOps et migrations</li>
          </ul>
        </div>
      </section>
    </main>
    <script>
      (function () {
        const themeButtons = document.querySelectorAll("[data-theme-toggle]");
        const densityButtons = document.querySelectorAll("[data-density-toggle]");
        const storedTheme = localStorage.getItem("theme");
        const storedDensity = localStorage.getItem("density");
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const initialTheme = storedTheme || (prefersDark ? "dark" : "light");
        const initialDensity = storedDensity || "normal";
        document.body.dataset.theme = initialTheme;
        document.body.dataset.density = initialDensity;
        themeButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const theme = btn.getAttribute("data-theme-toggle");
            document.body.dataset.theme = theme;
            localStorage.setItem("theme", theme);
          });
        });
        densityButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const density = btn.getAttribute("data-density-toggle");
            document.body.dataset.density = density;
            localStorage.setItem("density", density);
          });
        });

        const skillsToggle = document.querySelector("[data-skills-toggle]");
        const skillsCard = document.querySelector(".skills-card");
        if (skillsToggle && skillsCard) {
          const storedSkills = localStorage.getItem("skillsCollapsed") === "true";
          if (storedSkills) {
            skillsCard.dataset.skillsCollapsed = "true";
            skillsToggle.setAttribute("aria-expanded", "false");
            skillsToggle.setAttribute("aria-label", "Afficher les technos");
            skillsToggle.textContent = "+";
          }
          skillsToggle.addEventListener("click", () => {
            const collapsed = skillsCard.dataset.skillsCollapsed === "true";
            skillsCard.dataset.skillsCollapsed = collapsed ? "false" : "true";
            skillsToggle.setAttribute("aria-expanded", String(collapsed));
            skillsToggle.setAttribute(
              "aria-label",
              collapsed ? "Masquer les technos" : "Afficher les technos"
            );
            skillsToggle.textContent = collapsed ? "-" : "+";
            localStorage.setItem("skillsCollapsed", String(!collapsed));
          });
        }

        const canvas = document.getElementById("invaderGame");
        if (!canvas) {
          return;
        }

        const ctx = canvas.getContext("2d");
        const toggleBtn = document.querySelector("[data-game-action='toggle']");
        const resetBtn = document.querySelector("[data-game-action='reset']");
        const scoreEl = document.querySelector("[data-game-score]");
        const livesEl = document.querySelector("[data-game-lives]");

        const keys = new Set();
        const pointer = { active: false, startX: 0, lastX: 0, moved: false };
        const tapThreshold = 6;
        let gameOver = false;

        const game = {
          running: false,
          width: canvas.width,
          height: canvas.height,
          player: { x: 0, y: 0, w: 36, h: 14, speed: 280 },
          bullets: [],
          invaders: [],
          invaderDir: 1,
          invaderSpeed: 36,
          invaderDrop: 18,
          bulletSpeed: 360,
          lastShot: 0,
          shotDelay: 0.35,
          score: 0,
          lives: 3,
          level: 1,
          lastTime: 0,
        };

        const clamp = (value, min, max) => Math.min(Math.max(value, min), max);
        const setPlayerFromPointer = (clientX) => {
          const rect = canvas.getBoundingClientRect();
          const x = clientX - rect.left;
          game.player.x = clamp(x - game.player.w / 2, 8, game.width - game.player.w - 8);
        };

        const syncScore = () => {
          scoreEl.textContent = String(game.score);
          livesEl.textContent = String(game.lives);
        };

        const resizeGame = () => {
          const rect = canvas.getBoundingClientRect();
          const ratio = window.devicePixelRatio || 1;
          canvas.width = rect.width * ratio;
          canvas.height = rect.height * ratio;
          ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
          game.width = rect.width;
          game.height = rect.height;
          resetPlayer();
          buildInvaders();
        };

        const resetPlayer = () => {
          game.player.x = game.width / 2 - game.player.w / 2;
          game.player.y = game.height - game.player.h - 16;
        };

        const buildInvaders = () => {
          const rows = 4;
          const cols = 8;
          const invader = { w: 20, h: 14 };
          const gap = 12;
          const totalWidth = cols * invader.w + (cols - 1) * gap;
          const startX = (game.width - totalWidth) / 2;
          const startY = 34;

          game.invaders = [];
          for (let row = 0; row < rows; row += 1) {
            for (let col = 0; col < cols; col += 1) {
              game.invaders.push({
                x: startX + col * (invader.w + gap),
                y: startY + row * (invader.h + gap),
                w: invader.w,
                h: invader.h,
                alive: true,
              });
            }
          }
          game.invaderDir = 1;
        };

        const resetGame = () => {
          game.running = false;
          gameOver = false;
          game.score = 0;
          game.lives = 3;
          game.level = 1;
          game.bullets = [];
          resetPlayer();
          buildInvaders();
          syncScore();
          toggleBtn.textContent = "Démarrer";
        };

        const nextWave = () => {
          game.level += 1;
          game.invaderSpeed += 8;
          game.bullets = [];
          buildInvaders();
        };

        const fire = () => {
          const now = performance.now() / 1000;
          if (now - game.lastShot < game.shotDelay) {
            return;
          }
          game.lastShot = now;
          game.bullets.push({
            x: game.player.x + game.player.w / 2 - 2,
            y: game.player.y - 8,
            w: 4,
            h: 8,
          });
        };

        const update = (dt) => {
          if (pointer.active && pointer.moved) {
            setPlayerFromPointer(pointer.lastX);
          }
          if (keys.has("ArrowLeft")) {
            game.player.x -= game.player.speed * dt;
          }
          if (keys.has("ArrowRight")) {
            game.player.x += game.player.speed * dt;
          }
          game.player.x = clamp(game.player.x, 8, game.width - game.player.w - 8);

          if (keys.has("Space")) {
            fire();
          }

          game.bullets = game.bullets
            .map((bullet) => ({ ...bullet, y: bullet.y - game.bulletSpeed * dt }))
            .filter((bullet) => bullet.y + bullet.h > -10);

          let minX = Infinity;
          let maxX = -Infinity;
          let maxY = -Infinity;
          game.invaders.forEach((invader) => {
            if (!invader.alive) {
              return;
            }
            invader.x += game.invaderSpeed * dt * game.invaderDir;
            minX = Math.min(minX, invader.x);
            maxX = Math.max(maxX, invader.x + invader.w);
            maxY = Math.max(maxY, invader.y + invader.h);
          });

          if (minX < 12 && game.invaderDir < 0) {
            game.invaderDir = 1;
            game.invaders.forEach((invader) => {
              invader.y += game.invaderDrop;
            });
          } else if (maxX > game.width - 12 && game.invaderDir > 0) {
            game.invaderDir = -1;
            game.invaders.forEach((invader) => {
              invader.y += game.invaderDrop;
            });
          }

          game.bullets.forEach((bullet) => {
            game.invaders.forEach((invader) => {
              if (!invader.alive) {
                return;
              }
              const hit =
                bullet.x < invader.x + invader.w &&
                bullet.x + bullet.w > invader.x &&
                bullet.y < invader.y + invader.h &&
                bullet.y + bullet.h > invader.y;
              if (hit) {
                invader.alive = false;
                bullet.y = -999;
                game.score += 10;
              }
            });
          });

          game.bullets = game.bullets.filter((bullet) => bullet.y > -20);

          if (maxY >= game.player.y - 6) {
            game.lives -= 1;
            if (game.lives <= 0) {
              gameOver = true;
              game.running = false;
            } else {
              resetPlayer();
              buildInvaders();
              game.bullets = [];
            }
          }

          if (game.invaders.every((invader) => !invader.alive)) {
            game.score += 100;
            nextWave();
          }

          syncScore();
        };

        const getColor = (name, fallback) => {
          const value = getComputedStyle(document.body).getPropertyValue(name).trim();
          return value || fallback;
        };

        const draw = () => {
          const bg = getColor("--bg-accent", "#fbe0c3");
          const ink = getColor("--ink", "#344648");
          const accent = getColor("--accent", "#ffb98b");
          const muted = getColor("--slate", "#7d8e95");
          const line = getColor("--border", "rgba(52,70,72,0.2)");

          ctx.clearRect(0, 0, game.width, game.height);
          ctx.fillStyle = bg;
          ctx.fillRect(0, 0, game.width, game.height);

          ctx.strokeStyle = line;
          ctx.lineWidth = 1;
          ctx.strokeRect(4, 4, game.width - 8, game.height - 8);

          ctx.fillStyle = ink;
          ctx.fillRect(game.player.x, game.player.y, game.player.w, game.player.h);
          ctx.fillRect(game.player.x + 6, game.player.y - 6, game.player.w - 12, 6);

          ctx.fillStyle = accent;
          game.bullets.forEach((bullet) => {
            ctx.fillRect(bullet.x, bullet.y, bullet.w, bullet.h);
          });

          ctx.fillStyle = muted;
          game.invaders.forEach((invader) => {
            if (!invader.alive) {
              return;
            }
            ctx.fillRect(invader.x, invader.y, invader.w, invader.h);
            ctx.clearRect(invader.x + 5, invader.y + 4, 3, 3);
            ctx.clearRect(invader.x + invader.w - 8, invader.y + 4, 3, 3);
          });

          if (!game.running) {
            ctx.fillStyle = ink;
            ctx.font = "600 16px 'Space Grotesk', sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(
              gameOver ? "Game Over — clique pour rejouer" : "Clique pour jouer",
              game.width / 2,
              game.height / 2
            );
          }
        };

        const loop = (timestamp) => {
          const delta = (timestamp - game.lastTime) / 1000;
          const dt = Math.min(delta, 0.033);
          game.lastTime = timestamp;
          if (game.running && !gameOver) {
            update(dt);
          }
          draw();
          requestAnimationFrame(loop);
        };

        toggleBtn.addEventListener("click", () => {
          if (gameOver) {
            resetGame();
          }
          game.running = !game.running;
          toggleBtn.textContent = game.running ? "Pause" : "Démarrer";
        });

        resetBtn.addEventListener("click", () => {
          resetGame();
        });

        canvas.addEventListener("pointerdown", (event) => {
          canvas.setPointerCapture(event.pointerId);
          pointer.active = true;
          pointer.startX = event.clientX;
          pointer.lastX = event.clientX;
          pointer.moved = false;
          if (gameOver) {
            resetGame();
          }
          if (!game.running) {
            game.running = true;
            toggleBtn.textContent = "Pause";
          }
          event.preventDefault();
        });

        canvas.addEventListener("pointermove", (event) => {
          if (!pointer.active) {
            return;
          }
          pointer.lastX = event.clientX;
          if (Math.abs(pointer.lastX - pointer.startX) > tapThreshold) {
            pointer.moved = true;
          }
          setPlayerFromPointer(pointer.lastX);
          event.preventDefault();
        });

        canvas.addEventListener("pointerup", (event) => {
          if (!pointer.active) {
            return;
          }
          if (!pointer.moved) {
            fire();
          }
          pointer.active = false;
          pointer.moved = false;
          event.preventDefault();
        });

        canvas.addEventListener("pointercancel", () => {
          pointer.active = false;
          pointer.moved = false;
        });

        window.addEventListener("keydown", (event) => {
          if (["ArrowLeft", "ArrowRight", "Space"].includes(event.code)) {
            keys.add(event.code);
            if (game.running) {
              event.preventDefault();
            }
          }
        });

        window.addEventListener("keyup", (event) => {
          keys.delete(event.code);
        });

        window.addEventListener("resize", resizeGame);

        resizeGame();
        resetGame();
        requestAnimationFrame(loop);
      })();
    </script>
  </body>
</html>
